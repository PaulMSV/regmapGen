.. _lb:

========
LocalBus
========

LocalBus это пользовательский интерфейс шины. Вы можете использовать его для вашей Регистровой карты,
одна он был специально разработан для упрощения интеграции более распространенных интерфейсов шин. Он действует как внутренний "виртуальный" интерфейс.

Фактически, все остальные поддерживаемые шины (APB, AXI-Lite и т.д.) в regmapGen представляют собой всего лишь мосты (Bridge) к интерфейсу LocalBus, встроенному в Регистровую карту.

Сигналы
=======

====== ====== =========== =========================================================
Сигнал Ширина Направление Описание
====== ====== =========== =========================================================
waddr  >1     input       Write address bus
wdata  >1     input       Write data bus
wen    1      input       Write request enable signal
wstrb  >1     input       Write byte strobe bus (one bit for every write data byte)
wready 1      output      Write request ready signal
raddr  >1     input       Read address bus
ren    1      input       Read request enable signal
rdata  >1     output      Read data bus
rvalid 1      output      Read data valid signal
====== ====== =========== =========================================================

.. note::

    Конкретные ширины битов для шин определяются в разделе ``globcfg`` в файле ``config``.

Передача
========

Поддерживаются только простые одиночные передачи. Нет поддержки потоковых передач (burst) или передач блоками (stream). Каждая передача может быть расширена специальными сигналами.

Для примеров ниже ширина шины данных для всех сигналов ниже составляет 32 бита.

Запись
------

Запись данных ``D0`` по адресу ``A0``.

.. wavedrom::

    {"signal": [
      {"name": "clk", "wave": "p...."},
      {"name": "waddr", "wave": "x3x..", "data": ["A0"]},
      {"name": "wdata[31:0]", "wave": "x4x..", "data": ["D0"]},
      {"name": "wen", "wave": "010.."},
      {"name": "wstrb[3:0]", "wave": "x3x..", "data": ["0xF"]},
      {"name": "wready", "wave": "1...."}
    ]}

Запись с byte strobes
---------------------

Байт-строб сигнализирует о записи только байтов 1 и 2 (``wstrb = 0x6 = 0b0110``) данных ``D0``.

.. wavedrom::

    {"signal": [
      {"name": "clk", "wave": "p...."},
      {"name": "waddr", "wave": "x3x..", "data": ["A0"]},
      {"name": "wdata[31:0]", "wave": "x4x..", "data": ["D0"]},
      {"name": "wen", "wave": "010.."},
      {"name": "wstrb[3:0]", "wave": "x3x..", "data": ["0x6"]},
      {"name": "wready", "wave": "1...."}
    ]}

Запись с wait states
--------------------

Запись данных ``D0`` в адрес ``A0``, затем запись данных ``D1`` в ``A1``. Операция 
завершится (``wen`` переключится в 0), как только ``wready`` переключится в 1.

.. wavedrom::

    {"signal": [
      {"name": "clk", "wave": "p......."},
      {"name": "waddr", "wave": "x3x3..x.", "data": ["A0", "A1"]},
      {"name": "wdata[31:0]", "wave": "x4x4..x.", "data": ["D0", "D1"]},
      {"name": "wen", "wave": "0101..0."},
      {"name": "wstrb[3:0]", "wave": "x3x3..x.", "data": ["0xF", "0xF"]},
      {"name": "wready", "wave": "1.0..10."}
    ]}

Чтение
------

Чтение данных ``D0`` по адресу ``A0``. Минимальное время ответа - 1 такт. "Комбинационное" (в том же такте) чтение не поддерживается. 
Чтение завершится (``ren`` переключит в 0) после того, как установится ``rvalid``.

.. wavedrom::

    {"signal": [
      {"name": "clk", "wave": "p....."},
      {"name": "raddr", "wave": "x3.x..", "data": ["A0"]},
      {"name": "ren", "wave": "01.0.."},
      {"name": "rdata[31:0]", "wave": "x.4x..", "data": ["D0"]},
      {"name": "rvalid", "wave": "0.10.."}
    ]}

Чтение с wait states
--------------------

Чтение данных ``D0`` по адресу ``A0`` с двумя wait states.

.. wavedrom::

    {"signal": [
      {"name": "clk", "wave": "p......."},
      {"name": "raddr", "wave": "x3...x..", "data": ["A0"]},
      {"name": "ren", "wave": "01...0.."},
      {"name": "rdata[31:0]", "wave": "x...4x..", "data": ["D0"]},
      {"name": "rvalid", "wave": "0...10.."}
    ]}